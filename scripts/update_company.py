import bs4 as bs
import urllib.request
from stock.models import Company
import re
from socket import error as SocketError
import errno
import datetime

# print(ratio)
# ratio.save()

stock_No = [1,2,3,4,5,6,11,12,16,17,19,23,27,66,83,101,135,144,151,175,267,288,293,386,388,688,700,762,823,836,857,883,939,941,992,1038,1044,1088,1109,1113,1299,1398,1928,2018,2318,2319,2388,2628,3328,3988]
stock_name = ["CKH HOLDINGS","CLP HOLDINGS","HK & CHINA GAS","WHARF HOLDINGS","HSBC HOLDINGS","POWER ASSETS","HOIFU ENERGY","PCCW","NINE EXPRESS","HANG LUNG GROUP","HANG SENG BANK","HENDERSON LAND","HYSAN DEV","VANTAGE INT'L","SHK PPT","NEW WORLD DEV","ORIENTAL PRESS","SWIRE PACIFIC A","WHEELOCK","GREAT CHI PPT","MEXAN","BANK OF E ASIA","BURWILL","CHEVALIER INT'L","CHINA MOTOR BUS","GALAXY ENT","TIAN AN","DYNAMIC HOLD","BAN LOONG HOLD","CHINA AEROSPACE","CROSS-HAR(HOLD)","ASIA INV FIN","KOWLOON DEV","FE CONSORT INTL","FE HLDGS INTL","FE HOTELS","FIRST TRACTOR","CH BEIDAHUANG","GOLD PEAK","GREAT EAGLE H","NE ELECTRIC","C.P. POKPHAND","HAECO","HK&S HOTELS","COMPUTER & TECH","HOP HING GROUP","C AUTO INT DECO","HK FERRY (HOLD)","HARBOUR CENTRE","FAIRWOOD HOLD","GUOCO GROUP","HOPEWELL HOLD","NEWAY GROUP","ALLIED PPT (HK)","CHEN HSONG HOLD","SUNWAY INT'L","SKYFAME REALTY","HK FOOD INV","NORTH ASIA RES","TRANSPORT INT'L","CHINA GRAPHENE","GET NICE","GRAND OCEAN AR","MTR CORPORATION","LUMENA NEWMAT","LEE HING","SHANGRI-LA ASIA","NEPTUNE GROUP","MIRAMAR HOTEL","MODERN MEDIA","ASIAN CITRUS","Y.T. REALTY","SOUTH SEA PETRO","AMS TRANSPORT","REGAL INT'L","CENTURY LEGEND","CH OVS G OCEANS","V1 GROUP","SINO LAND","STELUX HOLDINGS","CHINA ELECTRON","SUN HUNG KAI CO","SWIRE PACIFIC B","TAI CHEUNG HOLD","TAI SANG LAND","AMBER ENERGY","INT'L STD RES","CHAMPION TECH","TERMBRAY IND","GREENHEART GP","LVGEM CHINA","YUSEI","HENDERSON INV","XINGFA ALUM","WONG'S INT'L","CLEAR MEDIA","HANG LUNG PPT","SUMMIT ASCENT","SHOUGANG CENT","ASIA COMM HOLD","ASSO INT HOTELS","LANDSEA PPT","SICHUAN EXPRESS","GR PROPERTIES","GOODRESOURCES","CHINA FORTUNE","CINDA INTL HLDG","LT COMM REALEST","DICKSON CONCEPT","HERALD HOLD","GRAND FIELD GP","CHOW SANG SANG","TIANLI HOLDINGS","COSMOS MACH","POLY PROPERTY","COSMOPOL INT'L","C.P. LOTUS","CROCODILE","YUEXIU PROPERTY","GD LAND","SUN HING VISION","CARRIANNA","CHINESE EST H","ENM HOLDINGS","ASIA STANDARD","MOISELLE INT'L","CHEUK NANG HOLD","CHINA INV HOLD","KUNLUN ENERGY","HENGTEN NET","JINHUI HOLDINGS","CCT FORTIS","CH SOFT POWER","GREAT CHINA","FIRST PACIFIC","GLOBAL TECH","CHINA MER PORT","HK BLDG & LOAN","TAI PING CARPET","IB SETTLEMENT","KINGBOARD CHEM","CH AGRI-PROD EX","WANT WANT CHINA","SHENZHEN INT'L","CHINA SAITE","BE ENVIRONMENT","CHINA SOLAR","LIPPO CHINA RES","NATURAL BEAUTY","MELBOURNE ENT","BROCKMAN MINING","HON KWOK LAND","AVIC IHL","CENTURY GINWA","EMPEROR INT'L","CHINA BAOLI TEC","CHINA EB LTD","NEWTIMES ENERGY","IDT INT'L","TSINGTAO BREW","WANDA HOTEL DEV","SILVER GRANT","GOLDBOND GROUP","K. WAH INT'L","GEMINI INV","GEELY AUTO","UNITED PACIFIC","JIANGSU EXPRESS","SA SA INT'L","JOHNSON ELEC H","KADER HOLDINGS","FUJIAN HOLDINGS","CONCORD NE","WINFULL GP","KECK SENG INV","ZH INT'L HOLD","GRANDE HOLDINGS","JINGCHENG MAC","SUNWAH KINGSWAY","DONGYUE GROUP","HKC (HOLDINGS)","LAI SUN INT'L","CAPITAL ESTATE","LIU CHONG HING","L'SEA RESOURCES","HONGHUA GROUP","HENG TAI","SMI HOLDINGS","ITC PROPERTIES","MELCO INT'L DEV","MAGNIFICENT","EVERCHINA INT'L","SEEC MEDIA","TSC GROUP","JOY CITY PPT","POLYTEC ASSET","WINSHINE SCI","DAPHNE INT'L","STYLAND HOLD","NANYANG HOLD","NATIONAL ELEC H","ASIA ORIENT","HUTCHTEL HK","CHINNEY INV","CHINA CHENGTONG","SHENWANHONGYUAN","SHUNHO PROPERTY","U-PRESID CHINA","EASY ONE FIN","MIN XIN HOLD","ELIFE HLDGS","PIONEER GLOBAL","POKFULAM","LIPPO","FIRST SHANGHAI","CHINA ENERGY","RAYMOND IND","MINMETALS LAND","PING AN SEC GP","AVIC INT'L","MY MEDICARE","NEW CENTURY GP","CHINA STRATEGIC","SAN MIGUEL HK","SAFETY GODOWN","EVERGREEN INT","PAK FAH YEOW","BUILD KING HOLD","ALI HEALTH","SHUN TAK HOLD","QPL INT'L","SINCERE","CN MINSHENG FIN","REALGOLD MINING","TST PROPERTIES","HKC INT'L HOLD","SINO-I TECH","SEA HOLDINGS","SE ASIA PPT","SHUNHO HOLDINGS","NUR HOLDINGS","LUNG KEE","CITYCHAMP","CHINA EB INT'L","TOMSON GROUP","YEEBO (INT'L H)","AVIC JOY HLDG","CCT LAND","DESON DEV INT'L","GT GROUP HLDG","ASCENT INT'L","ORIENT VICTORY","TIAN TECK LAND","CITIC","KINGDEE INT'L","CRTG","GUANGDONG INV","DAN FORM HOLD","SHUI ON LAND","MASON FIN","C BILLION RES","MASTER GLORY GP","MONGOLIA ENERGY","TERN PROPERTIES","WAH HA REALTY","FREEMAN FINTECH","KING FOOK HOLD","RIVERA (HOLD)","NEXT DIGITAL","GOLDIN PPT","BYD ELECTRONIC","CS HEALTH","WINFAIR INV","WH GROUP","WING ON CO","C FORTUNE FIN","CHINA RES BEER","ASIA STD HOTEL","CATHAY PAC AIR","YANGTZEKIANG","KONG SUN HOLD","EMPEROR E HOTEL","SINOFERT","CHUANG'S CHINA","NEW SPORTS","KUNMING MACHINE","VTECH HOLDINGS","WULING MOTORS","KWOON CHUNG BUS","UP ENERGY DEV","CHINA TRAVEL HK","XH NEWS MEDIA","LUEN THAI","SHIRBLE STORE","RICHLY FIELD","SMARTONE TELE","OOIL","COMEC","VONGROUP","CHINA METAL","COMPUTIME","TEXWINCA HOLD","TINGYI","MAANSHAN IRON","CHINA STAR ENT","PAX GLOBAL","ALCO HOLDINGS","DRAGONITE INT'L","ESPRIT HOLDINGS","FSE ENGINEERING","YUANHENG GAS","TOP FORM INT'L","CH DISPLAY OPT","UPBEST GROUP","HUABAO INTL","GREENLAND HK","SHANGHAI PECHEM","CHINA MINING","CAFE DE CORAL H","NEWOCEAN ENERGY","CULTURECOM HOLD","VITASOY INT'L","YANCHANG PETRO","ANGANG STEEL","CHINAHEALTHWISE","ASIA ENERGY LOG","FORTUNE SUN","ENERGY INTINV","CHINASOFT INT'L","CENTURY C INT'L","HNA INFRA","JIANGXI COPPER","HAISHENG JUICE","NEW FOCUS AUTO","SINO GOLF HOLD","C ZENITH CHEM","SHANGHAI IND H","PING SHAN TEA","UNIS HOLDINGS","LUKS GROUP (VN)","CHUANG'S INT'L","SINOTRANS SHIP","WING TAI PPT","CHINA BEST","BJ ENT WATER","ITC CORPORATION","ALLIED GROUP","FOUR SEAS MER","YGM TRADING","YUNFENG FIN","HUAJUN HOLD","FDG KINETIC","EG LEASING","SOFTPOWER INT","KIU HUNG INT'L","WELLING HOLDING","CHINA MED&HCARE","CHINA GAS HOLD","CHINNEY ALLI","SINOPEC CORP","LEEPORT(HOLD)","HKEX","TONTINE WINES","CHINA RAILWAY","MEI AH ENTER","BEIJING ENT","GLORIOUS SUN","SMARTAC GP CH","HING LEE (HK)","JUN YANG FIN","ORIENTAL WATCH","INNOVATIVE PHAR","COGOBUY","WANJIA GROUP","PEACEMAP HOLD","STARLITE HOLD","HSIN CHONG GP","YAU LEE HOLD","YIP'S CHEMICAL","SOHO CHINA","LAM SOON (HK)","CHINA INNO FIN","SC HOLDINGS","BANKOFJINZHOU","TSE SUI LUEN","FOUNDER HOLD","HUAYI TENCENT","FOUNTAIN SET","VMEP HOLDINGS","HKET HOLDINGS","MINTH GROUP","ONE MEDIA GROUP","ORIENTAL EXPL","G CHINA FIN","PCPD","NORTH MINING","BOYAA","NU ENVIRO","IRICO NEWENERGY","KUANGCHI","DAH SING","KTL INT'L","SINCEREWATCH HK","CHINA FIRE","CHIGO HOLDING","HUNG HING PRINT","GCL NEWENERGY","TIANDA PHARMA","NEW CITY DEV","TRISTATE HOLD","MIDLAND IC&I","SIHUAN PHARM","NATURAL DAIRY","KENFORD GROUP","FUTONG TECH","UNITEDENERGY GP","GAPACK","CAPXON INT'L","CMMB VISION","NEW SILKROAD","HAO TIAN DEV","ZHONG FA ZHAN","CH DYNAMICS","CIL HOLDINGS","HKR INT'L","SANDMARTIN INTL","BAUHAUS INT'L","FORGAME","CHINASINOSTAR","RUSAL","SUCCESSUNIVERSE","LAI SUN DEV","DONGFENG GROUP","SEE CORPORATION","GOME","LI & FUNG","PALADIN","KASEN","CSI PROPERTIES","PYI CORP","QINGDAO HLDGS","FRONTIER SER","LANSEN PHARMA","HUAN YUE INTER","CHINA FOODS","DINGYI GP INV","SUNSHINE","CASH FIN SER GP","TVB","CHINAGRANDPHARM","CONTINENTAL H","TC ORI LIGHT","COSCO SHIP INTL","TUNGTEX (HOLD)","APPLIED DEV","XIABUXIABU","HNA HOLDING","ASM PACIFIC","E-KONG GROUP","GUANGSHEN RAIL","LISI GP HOLD","RUIFENG RENEW","KINGDOM HOLDING","SIS INT'L","GOLDIN FIN HOLD","SAMSON HOLDING","WKK INTL (HOLD)","GOLDLION HOLD","GEMDALE PPT","TRADELINK","AJISEN (CHINA)","VICTORY CITY","SPEEDY GLOBAL","CENERIC","PACIFIC ONLINE","DAIDO GROUP","FUFENG GROUP","DIGITAL DOMAIN","SHENZHENEXPRESS","QIFENG FIBER","CINMEDIA","YUE YUEN IND","CHINACOMSERVICE","NANJING PANDA","HANS ENERGY","REXLOT HOLDINGS","PAN ASIA ENVIRO","CITY E-SOLUTION","LK TECH","DETAI NEWENERGY","CHU KONG SHIP","SH IND URBAN","ZMJ","ART GROUP HOLD","HANERGY TFP","DAISHOMICROLINE","SHANDONG MOLONG","CH AUTOMATION","TRAD CHI MED","ESUN HOLDINGS","FUTURE WORLD FH","TAO HEUNG HLDGS","PASHUN PHARMA","REGENT PACIFIC","ZHEJIANGEXPRESS","THE 13 HOLDINGS","ROSAN RES","JNCEC","SUN.KING ELEC","CHINA ORIENTAL","LANDING INTL","GWPA HOLDINGS","IMAGI INT'L","CONCH VENTURE","HUA HAN HEALTH","BEIJING N STAR","PORTICO INT'L","LUK FOOK HOLD","C HIGHPRECISION","BOSSINI INT'L","SKYOCEAN INTL","AV CONCEPT HOLD","INSPUR INT'L","SINOTRANS","E. BON HOLDINGS","CHINA INFRA INV","GROUP SENSE","JIAHUA STORES H","CHINA OIL & GAS","SHENZHEN INVEST","C FIN SERVICES","CHINA AGRI","FULLSHARE","HIGH FASHION","TIANDE CHEMICAL","WAI KEE HOLD","CNE TECH CORP","YUGANG INT'L","EMINENCE ENT","PALIBURG HOLD","PKU RESOURCES","SOUTH CHINA FIN","DTXS SILK ROAD","TAUNG GOLD","ENERCHINA HOLD","SINOMEDIA","PUBLIC FIN HOLD","U-RIGHT INT'L","GOME FIN TECH","YUE DA MINING","AMCO UNITED","SANY INT'L","PEARLORIENT OIL","CH ALL ACCESS","PLAYMATES","KERRY LOG NET","LEE KEE","KIN YAT HOLD","SHOUGANG RES","INFINITY DEV","CHTC FONG'S","CARRY WEALTH","ARES ASIA","CHINA ENV TEC","JOYCE BOUTIQUE","WAH YAN HEALTH","IDG ENERGY","CHI OCEAN IND","BONJOUR HOLD","HK CHINESE LTD","FOSUN INTL","G-VISION INT'L","C TRANSMISSION","NWS HOLDINGS","WAI CHUN MINING","CDAYENONFER","ASIA FINANCIAL","KING STONE ENGY","HAITONG INT'L","DOYEN INTL HOLD","TECHTRONIC IND","CHINA EAST AIR","ZHONGAN REALEST","CHINA HEALTH","CULTURELANDMARK","K & P INT'L","PEGASUS INT'L","GOLDEN RES DEV","GENTING HK","ASIA TELE-NET","NAN HAI CORP","CHI PEOPLE HOLD","CHAODA MODERN","KERRY PPT","ALLAN INT'L","MEDIA CHINESE","UNITED PV","HKICIM GROUP","CHINA OVERSEAS","EPI (HOLDINGS)","UNI-BIO GROUP","SHANSHUI CEMENT","CHINA HOUSEHOLD","TAN CHONG INT'L","BEIJING AIRPORT","DONGWU CEMENT","TRAVELSKY TECH","SHOUGANG INT'L","TONGDA GROUP","CAR INC","TENCENT","CNT GROUP","SINO OIL & GAS","FUTURE BRIGHT","HUSCOKE RES","DINGHE MINING","BEAUTI C HOLD","CO-PROSPERITY","EVERG HEALTH","GIORDANO INT'L","VARITRONIX INTL","ASIA ALLIED INF","COMTEC SOLAR","WORLD HOUSEWARE","CHINA OCEANWIDE","SINGAMAS CONT","EMPEROR CAPITAL","TAI UNITED HOLD","SHANDONG XINHUA","AUTO ITALIA","UMP","SUSTAIN FOREST","RUIXIN INT'L","PERENNIAL INT'L","CM DRAWIN TECH","CROWNICORP","CHINA TELECOM","FDG EVEHICLES","SHOUGANG GRAND","SAMSON PAPER","TRULY INT'L","HOPEFLUENT","C P NEW ENERGY","CHINA PPT INV","HOPEWELL INFR","LE SAUNDA","ASIA CEMENT CH","CN CULTURE GP","L & M CHEMICAL","SHENYANG PUBLIC","SINGYES SOLAR","SKYWORTHDIGITAL","PICO FAR EAST","AIR CHINA","HOPSON DEV HOLD","SHANGHAI ZENDAI","TIANYI SUMMI","SOLARGIGA","JUNEFIELD GROUP","CEC INT'L HOLD","TALENT PPT GP","BEL GLOBAL RES","CHINA UNICOM","ZTE","ETERNITY INV","PERFECTECH INTL","SINO PROSPER GP","PACIFIC PLYWOOD","CHINA RAREEARTH","AUTOMATED SYS","CKLIFE SCIENCES","IMPERIUM GP","NETDRAGON","GLOBAL BRANDS","PRIMEVIEW HLDG","COME SURE GROUP","CEOVU","IGG","A8 NEW MEDIA","GOLDEN MEDITECH","CHINA E-WALLET","PROSPERITY INTL","GLENCORE-S","VALUE PARTNERS","GLOBAL BIO-CHEM","XINHUA WINSHARE","SWSI","SHIMAO PROPERTY","JINGKELONG","CHI SILVER GP","HUADIAN FUXIN","CHINA JINMAO","HI SUN TECH","TIANNENG POWER","VC HOLDINGS","KA SHUI INT'L","NWDS CHINA","TIANGONG INT'L","KO YO GROUP","DYNASTY WINES","SHENGUAN HLDGS","FAR EAST GLOBAL","CR ASIA","CENTRAL CHINA","ALLTRONICS","KANGDA FOOD","ASIA COAL","CHINA RES POWER","CARPENTER TAN","EVA HOLDINGS","TIANYE WATER","CASSAVA RES","LEOCH INT'L","GRAND CONCORD","GLORIOUS PPT H","MINGFA GROUP","KAZ MINERALS-S","MAOYE INT'L","TOURONG CHANGFU","SHENG YUAN HLDG","STRONG PETRO","MICROPORT","WILLAS-ARRAY","CHINA WATER","VST HOLDINGS","PETROCHINA","EXTRAWELL PHAR","HENRY GROUP","O LUXE HOLD","DC HOLDINGS","VISION VALUES","BRANDINGCHINA","WING LEE PPT","JIANDE INT'L","CHINA QINFA","CMS","XINYI GLASS","PLAYMATES TOYS","CH DREDG ENV","TUS INTL","C TAIFENG BED","BAIYUNSHAN PH","CHINA FIN INV","MEGA MEDICAL","O-NET TECH GP","SOUNDWILL HOLD","SJM HOLDINGS","ZHONGSHENG HLDG","TIANJIN DEV","CNOOC","CIFI HOLD GP","RENTIAN TECH","SILVER BASE","EMPEROR WATCH&J","ROADSHOW","DATRONIX HOLD","TRINITY","CHINAVTM MINING","MAN YUE TECH","DONGJIANG ENV","HANISON","WAI YUEN TONG","MULTIFIELD INTL","ASIA RESOURCES","AEON CREDIT","HUANENG POWER","TPV TECHNOLOGY","CHINA GREEN","COFCO PACKAGING","ELEGANCEOPTICAL","ZHUHAI H INV","ZHONGDA INT'L","CHINA SANDI","QIANHAI HEALTH","SUGA INT'L","ANHUI CONCH","DAOHE GLOBAL","CHINA LONGYUAN","TAKSON HOLDINGS","MODERN BEAUTY","HISENSE KELON","ANXIANYUAN CH","IWS","BJ PROPERTIES","BESUNYEN","FUJIKON IND","TACK FIORI","IPE GROUP","CHINA LNG","RM GROUP","BRIGHTOIL","SINOPEC KANTONS","DRAGON CROWN","EAGLE LEGEND","MAN SANG INT'L","CCB","C ANIMAL HEALTH","CHINA MOBILE","EFORCE HOLDINGS","MANULIFE-S","MOBI DEV","Z-OBEE","LEE'S PHARM","CHAOWEI POWER","QUAM","SHAW BROTHERS","CHANGMAO BIO","CHINA SUNTIEN","HN RENEWABLES","AMAX INT HOLD","LONGFOR PPT","BLOOMAGE BIOTEC","CHINA TAIPING","SOUND GLOBAL","XINYI SOLAR","HUA LIEN INT'L","SPARKLE ROLL","L'OCCITANE","SKL","MONGOL MINING","CHIHO-TIANDE","CHI MER LAND","GREEN ENERGY GP","LIANHUA","SMIC","IONE HOLDINGS","SOCAM DEV","AEON STORES","NETMIND FIN","CH ENV ENERGY","CH RENEW EN INV","LOUDONG GN RES","GROUND INTL DEV","THEME INT'L","DATANG POWER","LENOVO GROUP","HUARONG INT FIN","ANHUIEXPRESSWAY","CARNIVAL GROUP","CHINLINK INTL","CITIC BANK","I.T","BEIJING MEDIA","HK SH ALLIANCE","V.S. INT'L","HUANXI MEDIA","C SMARTERENERGY","MATRIX HOLDINGS","CHANGSHOUHUA","DAQING DAIRY","BRILLIANT CIR","INT'L ENT","PACRAY INT'L","NT PHARMA","WAI CHUN GROUP","CONVOY","SINOREF HLDGS","MIDAS HLDGS-S","FEIYU","SITOY GROUP","UNIVERSAL TECH","CHINA JICHENG","C.BANNER","IRC","FUTURE LAND","KINGSTON FIN","SINOPEC SSC","BBI LIFE SCI","VANKE PPT OVS","MAXNERVA TECH","CKI HOLDINGS","FORTUNET E-COMM","LAMTEX HLDGS","COSLIGHT TECH","HENGAN INT'L","APT SATELLITE","UNI INTL FIN","NGAI HING HONG","YORKSHINE HLDGS","CELESTIAL ASIA","KARRIE INT'L","G-RESOURCES","YUEXIUTRANSPORT","CHONGQING IRON","CHINA SOUTH AIR","ZHEJIANG SHIBAO","GUANGDONG TANN","KANTONE HOLDING","ALI PICTURES","ESSEX BIO-TECH","SUNCORP TECH","ZHONG HUA INT'L","TIANJIN CAPITAL","WEIGAO GROUP","YURUN FOOD","CA LOW-CARBON","TCL MULTIMEDIA","HUADIAN POWER","DONGFANG ELEC","CHINA AGROTECH","CAPINFO","IMPERIAL PAC","PINE TECH","SHENGLI PIPE","HK EDU INTL","TOWNGAS CHINA","HXTL","GOODBABY INTL","INVESTECH HLDGS","CHINA SHENHUA","LEYOU TECH H","DA MING INT'L","CITIC DAMENG","CSPC PHARMA","C P PROCUREMENT","SINO ENERGY INT","I-CABLE COMM","ROAD KING INFRA","SINOPHARM","MAINLAND HOLD","HUARONG ENERGY","ENVIRO ENERGY","DASHENG AGR FIN","APAC RESOURCES","SING TAO","SINO HAIJING","MODERN LAND","LUOYANG GLASS","CHINA RES LAND","KINGWORLD","CHONG HING BANK","BIOSTIME","CK PROPERTY","BRILLIANCE CHI","TIBET WATER","MAYER HOLDINGS","CH MODERN D","GOLIK HOLDINGS","ARTS OPTICAL","BAOFENGMODERN","QINGLING MOTORS","CHINA-HK PHOTO","COASTAL GL","LAI FUNG HOLD","DREAM INT'L","1010 PRINTING","WYNN MACAU","WATER INDUSTRY","CHINA ENV RES","AGRITRADE RES","ORANGE SKY G H","HARBIN ELECTRIC","ASIA SATELLITE","TCC INT'L HOLD","HKTV","COSCO SHIP ENGY","VICTORY GROUP","SKYWAY SEC","SIBERIAN MINING","CH HCARE ENT","COURAGEMARINE","CH OUTFITTERS","POWER XINCHEN","ANXIN-CHINA","MILAN STATION","ELEC & ELTEK","INFINITY FIN","CENTRON TELECOM","ZOOMLION","JIMEI INT ENT","WATER OASIS GP","DEJIN RES","CGN MINING","SFCE","SOLARTECH INT'L","SINOLINK HOLD","HAIER ELEC","KINGMAKER","YANZHOU COAL","MIDAS INT'L","VEEKO INT'L","PACIFIC ANDES","FRESH EXP","ZHUGUANG HOLD","SINO BIOPHARM","SHARE ECON GP","PARADISE ENT","TANG PALACE","SUCCESS DRAGON","S.A.S. DRAGON","CHINA ENERGINE","CHINA RAIL CONS","HAN TANG INTL","HYBRID KINETIC","ROSEDALE HOTEL","BOLINA","YUESHOU ENV","TITAN PETROCHEM","CHINA RES GAS","MUNSUN CAPITAL","KINGWELL GROUP","REALORD GROUP","CHINA HENGSHI","ROYALE FURN","COSCO SHIP PORT","MIDLAND HOLDING","TESSON HOLDINGS","CHENGDU PUTIAN","GUANGNAN (HOLD)","CITIC RESOURCES","TECHNOVATOR","SRE GROUP","MMG","CHRISTINE","BYD COMPANY","LIFESTYLE INT'L","MOBICON GROUP","KAI YUAN HLDGS","EASYKNIT INT'L","TENWOW INT'L","ZHIDAO INT'L","SINO HOTELS","WANG ON GROUP","SYMPHONY HOLD","C C LAND","LERADO FIN","SUPERB SUMMIT","NAN NAN RES","YASHILI INT'L","NEWTON RES","GW TIANDI","TIMES PPT","CHINA LILANG","TRAVEL EXPERT","NATIONAL AGRI","CH ENV TECH&BIO","POWERLONG","JIN BAO BAO H","CNQC INT'L","SHUANGHUA H","WANG ON PPT","NIRAKU","NGAISHUN HOLD","MIKO INTL","TONLY ELEC","BE CLEAN ENERGY","SPT ENERGY","CHINA TIANRUI","GREENLAND BROAD","S. CULTURE","CEB GREENTECH","CHINFMINING","CH CHILD CARE","WONDERFUL SKY","LABIXIAOXIN","PC PARTNER","TIANJINJINRAN","XIWANG STEEL","MEIDONG AUTO","FIRST CAP GP","LANGHAM-SS","GRAND MING","DATANG ENVIRO","HK FINANCE GP","KINETIC M&E","CHINANEWTOWN","HUIYIN SMARTCOM","LT SMART ENERGY","CHINA GOLDJOY","JIASHILI GP","ABC","SUNLIT SCI","CHINA HUIRONG","CMA LOGISTICS","GRAND BAOXIN","GUODIAN TECH","SINOSOFT TECH","TECHCOMP","AIA","TRIGIANT","D&G TECH","LIFETECH SCI","HUILI RES","WAI CHI HOLD","SITC","HKBN","TONGFANG KONTA","CHINARES CEMENT","TSUI WAH HLDG","VISION FAME","NEXTEER","MAPLELEAF EDU","GREENS HOLDINGS","OIWAHPAWN","CHINA NEWCITY","CW GROUP HOLD","NEWTREE GROUP","PEGASUS ENT","TIME2U","INT'L ELITE","CAPITAL JUDA","DYNAGREEN ENV","CHINA TOUYUN","CHINA ZHONGWANG","SHEEN TAI","NCI","BAWANG GROUP","PICC GROUP","HUISHENG INTL","CLEAR LIFT","PIONEER PHARM","HUA HONG SEMI","QUALI-SMART","FUDANZHANGJIANG","NUOQI","LEGEND STRAT","MEITU","PW MEDTECH","CHINA CINDA","MEGAEXPO HLDG","361 DEGREES","SIS MOBILE","CTEG","RUNDONG AUTO","JIANGNAN GP","HANBO ENT HLDGS","XTEP INT'L","WUZHOU INT'L","HENGSHIMINING","CHINA LOTSYN","BISU TECH","IH RETAIL","CC SECURITIES","CHINAHONGQIAO","CHI KINGSTONE","CANVEST ENV","PACIFICTEXTILES","SUNCITY GROUP","SHANGHAI FUDAN","VESTATE GROUP","RENHE COMM","EMBRY HOLDINGS","MAJOR HLDGS","HIDILI INDUSTRY","ELL ENV","HYDOO INTL","BAGUIO GREEN","ICBC","SCUD GROUP","WANG TAI HLDG","COWELL","SINOMAX GROUP","HUMAN HEALTH","CHUAN HOLDING","KINGBO STRIKE","BRIGHT SMART","SUCHUANG GAS","YST DAIRY","CHINA SHENGMU","CH PACK DEV","FULUM GP HLDG","HUNGFOOKTONG","SFK","FU SHOU YUAN","CENTURY SAGE","DENOX ENV","GUOLIAN SEC","ZHOU HEI YA","JUJIANG CONS","ICO GROUP","LUZHENG FUTURES","GOLD-FIN HLDG","AFFLUENTPARTNER","UKF","GET NICE FIN","TIC TAC INT'L","HENGTOU SEC","Q TECH","YAN TAT GROUP","U BANQUET GP","C CHENG HLDGS","BEST FOOD HLDG","ZHONGDI DAIRY","JIYIHOUSEHOLD","AP RENTALS","PURAPHARM","LEAP HLDGS-NEW","INCON","CHINA RE","HARMONICARE","LIVZON PHARMA","CRPHOENIXHEALTH","NC HEALTHCARE","RUNWAY GLOBAL","C CITYRAILTEC","PLOVER BAY TECH","RICI HEALTH","TENGY ENV","RS MACALLINE","3SBIO","CHINA PARTYTIME","ZHUANGYUAN PA","YUK WING GP","ZHONG AO HOME","SYNERGY GROUP","JOIN-SHARE","IBI GROUP HLDGS","GENSCRIPT BIO","EVER HARVEST GP","MIE HOLDINGS","CHINNEY KW","K.H. GP HLDGS","HEC PHARM","KWAN ON HLDGS","STAR PROPERTIES","MANFIELD CHEM","VIRSCEND EDU","CHINA ANIMATION","SUNDART HLDGS","MINSHENG EDU","WEIYE HOLDINGS","CHINA ART FIN","CH UNIENERGY","MORRIS HOLD","HUIXIN CREDIT","BANK OF TIANJIN","YIHAI INTL","DA SEN HLDGS","PROGRESSIVE P","QINQIN FOODS","YADEA","CHINA LEON","CHANJET","CNLP","SHUN WO GROUP","YICHEN IND","UCD","TIAN LUN GAS","CDB LEASING","VPOWER GROUP","CHONG KIN GP","COFCO MEAT","PANTRONICS HLDG","VINCENT MED","SYNERTONE","SILVERMAN HL","NANFANG COMM","MCC","TIANHE CHEM","REDCO PPT","HILONG","JIA YAO HLDGS","ABLE ENG HLDGS","YUZHOU PPT","MENGKE HLDGS","FOODWISE HLDG","SHEUNG YUE GP","DZUG","CMRU","SH GROUP HLDG","KAISA GROUP","AKM INDUSTRIAL","SHIS LTD","OKURA HOLDINGS","ISDN HOLDINGS","PSBC","SANROC INT'L","WISDOM SPORTS","YEE HOP HLDGS","S HARBOURHOLD","TONG REN TANG","MILESTONE BUILD","CHINASOUTHCITY","GIC GROUP","HUAZHANG TECH","CREATIVE GLOBAL","MACAU LEGEND","CONSUN PHARMA","HIGHLIGHT IOT","ROYAL CHINA INT","BOER POWER","HUAXIHOLDINGS","BOSHIWA INT'L","PUTIAN FOOD","SPRINGLAND","SAMPLE TECH","AUSNUTRIA","WAN KEI GROUP","ZHENGTONGAUTO","E-COMMODITIES","FS ANTHRACITE","CRRC","SUNFONDA GP","GF SEC","FANTASIA","COLOUR LIFE","CRCCE","GUOTAI JUNAN I","DATANG RENEW","XINTE ENERGY","CHINA COMM CONS","BJ SPORTS & ENT","ENTERPRISE DEV","CGN NEW ENERGY","CHENMING PAPER","KWG PROPERTY","CGN POWER","ZHAOJIN MINING","FUGUINIAO","HONGDA FIN","HUAYUEXPRESSWAY","DCH HOLDINGS","CMEC","PERFECT SHAPE","SHIFANG HLDG","STELLA HOLDINGS","CHINAPROPERTIES","CALC","ERNEST BOREL","CHUNLI MEDICAL","JINGRUI HLDGS","CHI LONGEVITY","CHINA XLX FERT","NEO-NEON","SOUTHGOBI-S","BELLE INT'L","HAITIAN INT'L","CITIC TELECOM","EPRINT GROUP","CH WOOD OPT","HUIYUAN JUICE","KB LAMINATES","WUYI PHARMA","SINOMA","CHINA COAL","XINGDA INT'L","CHINA ITS","C&D INTL GROUP","SAMSONITE","PRADA","SUNAC","COSCO SHIP HOLD","SANDS CHINA LTD","CHOW TAI FOOK","CHU KONG PIPE","BAIC MOTOR","BCQ","CHINA SCE PPT","IMAX CHINA","SWIREPROPERTIES","TEN PAO GROUP","TIANGE","NAMESON HLDGS","MICROWARE","TSAKER CHEM","MINSHENG BANK","PINE CARE GP","TA YANG GROUP","ASIARAY","FLYKE INT'L","MAN WAH HLDGS","SIM TECH","NEW HIGHER EDU","SUNSHINE PAPER","SSY GROUP","JINJIANG HOTELS","COUNTRY GARDEN","PHOENIX TV","BBMG","REAL NUTRI","KEE","SUNSHINE OIL","OZNER WATER","CZBANK","CHANHIGH","AAC TECH","ANTA SPORTS","CHINA LUDAO","JOLIMARK","CABBEEN","AUSUPREME","TIME WATCH","FIH","CIMC","SHENGJINGBANK","CHALIECO","PANASIALUM","AUX INTL","NATURE HOME","ADVANCED CARD","XIWANG PROPERTY","ZALL GROUP","CHINAGOLDINTL","BAIOO","BEST PACIFIC","CAA RESOURCES","CHERISH HLDGS","TIAN SHAN DEV","KN HOSPITAL","FIRST CHEM","GOLDEN SHIELD","CHINA LESSO","CH POLYMETAL","LIFESTYLE CHI","UM HEALTHCARE","SMART-CORE","YINGDE GASES","PETRO-KING","LIFESTYLE PPT","LUYE PHARMA","TITANS ENERGY","MAN KING HOLD","FOSUN PHARMA","CHINA SANJIANG","REGINA MIRACLE","HOSA INT'L","CHINA VANKE","GOLDWIND","UNI HEALTH","FB MINING","YI HUA HLDG-NEW","ANDRE JUICE","NEW CONCEPTS","NVC LIGHTING","CASABLANCA","HONWORLD GP","CECEP COSTIN","CG DUNXIN","WESTCHINACEMENT","WISON ENGRG","GAC GROUP","SMIT","HAICHANG HLDG","LAI SI ENT","YOUYUAN HLDGS","HUARONG INV","HAILAN HLDGS","HC INTL","XINGLU WATER","MGM CHINA","TK GROUP HLDG","CHEN XING","RYKADAN CAPITAL","CHARMACY PHAR","BAMBOOSHEALTH","COSMO LADY","BILLION IND","AMVIG HOLDINGS","CNNC INT'L","HENGXING GOLD","KAM HING INT'L","EVOC","BIRMINGHAM SPTS","FOREBASE INTL","SHENZHOU INTL","LEE & MAN PAPER","VEDAN INT'L","PING AN","MENGNIU DAIRY","HOP FUNG GROUP","NOBLE CENTURY","CHINA HKBRIDGE","BEP INT'L HOLD","MEILLEUREHEALTH","PICC P&C","GUORUI PPT","CHINA UPTOWN","LI NING","GREATWALL MOTOR","HAILIANG INTL","WEICHAI POWER","BWI INT'L","SYNERGIS HOLD","ECOGREEN","COMBA","PACIFIC BASIN","SHANGHAI PRIME","DAWNRAYS PHARMA","CH CITY INFRA","BAOYE GROUP","DAHSING BANKING","AVICHINA","JIU RONG HOLD","JINCHUAN INTL","SMI CULTURE","EAGLE NICE","COOLPAD GROUP","C CHUANGLIAN ED","PRU","ZHONGTIAN INT'L","CHINA POWER","SUNNY OPTICAL","TOM GROUP","SINOPEC SEG","BOC HONG KONG","BJ ENT M&H","YESTAR HEALTH","GOOD FRIEND","FORDOO","TRONY SOLAR","LAUNCH TECH","BOC AVIATION","CHALCO","CPIC","SH PHARMA","SUNSHINE 100","GTJA","ADD NEW ENERGY","CHINA LIFE","JACOBSON PHARMA","HKELECTRIC-SS","CAMSING INTL","UNI MEDICAL","PAK TAK INT'L","CHINA OVS PPT","TEXHONG TEXTILE","AAG ENERGY","ENN ENERGY","ND PAPER","WEIQIAO TEXTILE","XINMING CHINA","GREEN INTL HLDG","CHONGQING M&E","SH ELECTRIC","YUHUA ENGY-NEW","HUAJIN INTL","JIAYUAN INTL","R&F PROPERTIES","YORKEY OPTICAL","YUANDA CHINA","CHINA HUARONG","COSCO SHIP DEV","BJ CAPITAL LAND","GREENTOWN SER","SHINEWAY PHARM","SOLOMON SYSTECH","DALIAN PORT","HKRH","CHINA OILFIELD","BINHAI INV","STANCHART","NRI HOLDINGS","LONGRUN TEA","ZIJIN MINING","LEAP HLDGS-OLD","C ZENITH CHEM","YUHUA ENGY-OLD","YI HUA HLDG-OLD","XINYI SOLAR RTS","PLAYMATES","MIN XIN RTS","CHINA GLASS","RONSHINECHINA","JUTAL OIL SER","JNBY","GOLDEN EAGLE","CHINA STATE CON","ARTGO HOLDINGS","GOLDPAC GROUP","CHINA FLAVORS","CHINARES PHARMA","WIN HANVERKY","CNBM","PERFECT GROUP","BANKCOMM","BOCOM INTL","LINGBAO GOLD","VINDA INT'L","SINOLIFE UTD","EVERGRANDE","DBA TELECOM","JU TENG INTL","ANTON OILFIELD","LONKING","ADDCHANCE","ASMC","FE HORIZON","ZHENGYE INT'L","OCT (ASIA)","PARKSON GROUP","QHD PORT","SINO-OCEAN GP","XIAMEN PORT","LOGAN PPT","TIANJINPORT DEV","AGILE GROUP","HENGDELI","WASION GROUP","PERSTA","LEGENDHOLDING","CHINA TING","YUEYUN TRANS","MODERN DENTAL","FUYAO GLASS","YONGSHENG MAT","CQRC BANK","C SUCCESS FIN","HSSP INTL","RENHENG ENT","ZHONGYU GAS","POLY CULTURE","HUABANG FIN","YIDA CHINA","XIEZHONG INTL","XIAO NAN GUO","YONGDA AUTO","HOLLY FUTURES","GREAT HARVEST","CLIFFORDML","TOP SPRING","KANGHUA HEALTH","HUISHANG BANK","YAT SING HLDG","KORADIOR","ZHONGZHIPHARM","DCWT","NNK","C FIBER OPTIC","CHINA WEAVING","CHINA HANKING","ROYAL DELUXE","DALI FOODS","GCL-POLY ENERGY","SINOTRUK","POU SHENG INT'L","KFM KINGDOM","CHINA DONGXIANG","SAM WOO CONS","TECH PRO","MING FAI INT'L","XINXIN MINING","HARMONY AUTO","CHINA STARCH","CT ENTERPRISE","BQD","QX PAPER","HOSPITAL CORP","SKYLIGHT HLDG","CHINA AOYUAN","TOWN HEALTH","KINGSOFT","GLOBAL SWEET","CROSSTEC","CRRC TIMES ELEC","CIMC ENRIC","GREENTOWN CHINA","HANHUA FIN","CICC","NAGACORP","UNITED LAB","WANGUO MINING","YITAI COAL","DFZQ","RONGZHONG FIN","CH BAOFENG INTL","CM BANK","CHINA CRSC","CHINA BLUECHEM","BANK OF CHINA","CAPITAL ENV","CMOC","CH ENERGY ENG","BOSIDENG","DACHAN FOOD","BOC 2014 PREF","ICBC USDPREF1","ICBC EURPREF1","BOCOM 15USDPREF","CCB 15USDPREF","CINDA 16USDPREF","HSBNK 16USDPREF","CMBC 16USDPREF","CZB 17USDPREF","CITIC SEC","TELECOM DIGIT","CSC","WISDOM EDU INTL","CMSC","NEW RAY MEDIC","LA CHAPELLE","AUSTAR","JIUTAI RCB","ON TIME LOG","EARTHASIA","VITAL MOBILE","KANGDA ENV","HARBIN BANK","JINMAO HOTEL-SS","TARGET INS","GEMILANG INTL","CHINA VAST","CHINA U-TON","YUHUA EDU","EB SECURITIES","CH GREENFRESH","BJ DIGITAL","ADWAY","BANKOFZHENGZHOU","QINGDAO PORT","SUNART RETAIL","PROSPER CONS","CEB BANK","KING'S FLAIR","HKT-SS","HAOHAI BIOTEC","BG BLUE SKY","HUAZHONG IN-V","SINCO PHARMA","TIANYUN INT'L","HAITONG SEC","WINOX","YUNNAN WATER","HONMAGOLF","HUISHAN DAIRY","FLAT GLASS","ZUOLI M-FIN","TENFU","YOFC","DIFFER GROUP","TEMPUS HOLD","CGS","EGL HOLDINGS","HTSC","FREETECH","DYNAM JAPAN","HINSANG GROUP","GOLDEN THROAT","CHINA ALUMCAN","OURGAME","HOPEWELL INFR-R","ICBC CNHPREF1-R"]
failed_list = []
stock_list = {}
for i in range(0,len(stock_No)):
    stock_list["HK"+str(stock_No[i])] = {'stock_no': stock_No[i],'name': stock_name[i]}


# Financial Ratio
company_url = 'http://www.aastocks.com/en/stocks/analysis/company-fundamental/company-profile/?symbol='
company_info_url = 'http://www.aastocks.com/en/stocks/analysis/company-fundamental/basic-information?symbol='
company_dict = {"COM_IssuedShare":"Share Issued (share)","COM_ParCurrency":"Par Currency","COM_ParValue":"Par","COM_Industry":"Industry","COM_Profile":"Corporate Profile","COM_ListingDate":"Listing Date","COM_AuthCapital":"Authorized Capital(share)","COM_IssuedCapital":"Issued Capital(share)","COM_BoardLot":"Board Lot",}
#
for i in stock_list:
    code = stock_list[i]['stock_no']
    print(code)

    # financial-ratio
    try:
        company_html = urllib.request.urlopen(company_url+str(code)).read()
        company_soup = bs.BeautifulSoup(company_html,'html5lib')
    except SocketError as e:
        if e.errno != errno.ECONNRESET:
            raise  # Not error we are looking for
        failed_list.append(code)
        pass  # Handle error here

    table_row = company_soup.find_all('tr')
    for tr in table_row:
        td = tr.find_all('td')
        row = [a.text.strip() for a in td]
        if row[0] in company_dict.values():
                stock_list[i][list(company_dict.keys())[list(company_dict.values()).index(row[0])]] = row[1:]

    # Earnings Summary
    company_info_html = urllib.request.urlopen(company_info_url+str(code)).read()
    company_info_soup = bs.BeautifulSoup(company_info_html, 'html5lib')
    table_row = company_info_soup.find_all('tr')
    for tr in table_row:
        td = tr.find_all('td')
        row = [a.text.strip() for a in td]
        if row[0] in company_dict.values():
            stock_list[i][list(company_dict.values())[list(company_dict.values()).index(row[0])]] = row[1:]

    if code < 10: stock_id = '000' + str(code)
    elif code < 100: stock_id = '00' + str(code)
    elif code < 1000: stock_id = '0' + str(code)
    else: stock_id = str(code)

    Company.objects.get_or_create(stock_id=stock_id)
    company = Company.objects.get(stock_id=stock_id)
    try: company.name = stock_list[i]['name']
    except: pass
    try: company.board_lot = int(stock_list[i]['Board Lot'][0].replace(',',''))
    except: pass
    try:
        if company.list_date is not '-':
            company.listing_date = stock_list[i]['Listing Date'][0].replace('/','-')
    except: pass
    try: company.auth_capital = int(stock_list[i]['Authorized Capital(share)'][0].replace(',',''))
    except: pass
    try: company.issued_capital = int(stock_list[i]['Issued Capital(share)'][0].replace(',',''))
    except: pass
    try: company.par_currency = stock_list[i]['Par Currency'][0]
    except: pass
    try: company.par_value = float(stock_list[i]['Par'][0])
    except: pass
    company.save()

print(failed_list)
    # Company.objects.get_or_create(
    #     COM_StockCode = code,
    #     COM_Name = stock_list[i]['name'],
    #     COM_IssuedShare=stock_list[i]['COM_IssuedShare'][0],
    #     COM_ParCurrency=stock_list[i]['COM_ParCurrency'][0],
    #     COM_ParValue=stock_list[i]['COM_ParValue'][0],
    #     COM_Industry=stock_list[i]['COM_Industry'][0],
    #     COM_Profile=stock_list[i]['COM_Profile'][0],
    #     COM_ListingDate=stock_list[i]['COM_ListingDate'][0],
    #     COM_AuthCapital=stock_list[i]['COM_AuthCapital'][0],
    #     COM_IssuedCapital=stock_list[i]['COM_IssuedCapital'][0],
    #     COM_BoardLot=stock_list[i]['COM_BoardLot'][0],
    # )
    #
